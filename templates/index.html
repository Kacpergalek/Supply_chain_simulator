<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Supply Chain Simulation</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/codemirror.min.css">
</head>
<body>
<div class="form-container">
    <h1>Supply Chain Disruption Simulation</h1>
    <form id="disruptionForm">
        <div class="form-group">
            <label for="disruptionType">Disruption Type:</label>
            <select id="disruptionType" name="disruptionType" required>

            </select>
        </div>

        <div class="form-group">
            <label for="severity">Disruption Severity:</label>
            <select id="severity" name="severity" required>

            </select>
        </div>

        <div class="form-group">
            <label for="duration">Duration:</label>
            <select id="duration" name="duration" required>

            </select>
        </div>

        <div class="form-group">
            <label for="dayOfStart">Day of Start:</label>
            <select id="dayOfStart" name="dayOfStart" required>

            </select>
        </div>

        <div class="form-group">
            <label for="placeOfDisruption">Place of Disruption (Node ID):</label>
            <select id="placeOfDisruption" name="placeOfDisruption" required>

            </select>
        </div>
    </form>

    <button onclick="sendData()">Submit</button>
    <div id="output"></div>
    <div id="message" class="message"></div>
</div>

<script>
    async function readJSON(appRoute, query) {

        const response = await fetch(appRoute);
        const data = await response.json();

        const select = document.querySelector(query);
        select.innerHTML = "";

        data.forEach(word => {
            const option = document.createElement("option");
            option.innerHTML = `<option>${word}</option>`;
            select.appendChild(option);
        });
    }

    readJSON("/api/disruption_type", "#disruptionType");
    readJSON("/api/disruption_severity", "#severity");
    readJSON("/api/duration", "#duration");
    readJSON("/api/day_of_start", "#dayOfStart");
    readJSON("/api/place_of_disruption", "#placeOfDisruption");

</script>
<script>

    function sendData() {
        var text = "";
        var dict = {}
        var listOfForms = ["disruptionType", "severity", "duration", "dayOfStart", "placeOfDisruption"];
        for (index in listOfForms) {

            var e = document.getElementById(listOfForms[index]);
            text += e.options[e.selectedIndex].text;
            dict[listOfForms[index]] = e.options[e.selectedIndex].text;
        }

        $.ajax({
            url: '/api/process',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(dict),
            success: function (response) {
                document.getElementById('output').innerHTML = JSON.stringify(response, null, 2);
            },
            error: function (error) {
                console.log(error);
            }
        });
    }
</script>
</body>
</html>